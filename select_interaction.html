<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Select Interaction</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="Api.js"></script>

<style>
    div.ex0{
        width: auto;
        height: 150px;
        border-style: solid;
        border-width: 1px;
    }
    div.ex1{
        background-color: lightblue;
        width: 500px;
        height: 500px;
        overflow: scroll;
        /*display: table;*/
        margin: 0 auto;
        position: static;
    }
    div.ex2{
        background-color: white;
        width: 400px;
        height: 125px;
        float: right;
        margin-right: 10px;
        margin-top: 10px;
        border-style: solid;
        border-width: 1px;
        position: static;
        box-sizing: border-box;
        padding-top: 20px;

    }
    div.ex3{
    alignment: center;
    }
</style>
</head>
<body>


<form action = index.html>
    <input type = "submit" id = "back" value = "Back">
</form>
<h1 align="center">Select Interaction</h1>
<div id="studentInfo" align="center"></div>
<div id="main" align="center" class="ex1"></div>
<!--
<input type = "button" id="view" value="View Results" onclick="getName()">

<input type = "button" id="cdiv" value="Create Div" onclick="createDiv()">
-->

<Script language="JavaScript">

    var sa = new SheetsApi();
    sa.setKeys("1SWI9vIs5OLg03q3pGzRNLXkvtpvyAUh5Qp3_NYv8jYM", "AIzaSyD5KpN_FCSGTRJGlDFN9CvXD3gyg-f8ZC4", "656316403501-g3io4mu5ibfebpls8jrnht04rg8g2mr1.apps.googleusercontent.com");
    sa.handleClientLoad();

    function updateSignInStatus(isSignedIn){
    if(isSignedIn){
        console.log("Is singed in");
        getName();
        createDiv();
    // window.onload = getName;
    window.onload = createDiv;
    } else {
    console.log("Need Log In!");
    sa.handleSignInClick();
    }
    }



    //columns to be returned
    var nameReturned = ["LAST_NAME", "FIRST_NAME", "EMAIL"];
    var interactionReturned = ["INTERACTION_TYPE", "INTERACTION_DATE", "LIBRARIAN_INITIATED", "FOLLOW_UP", "MINUTES", "COMMUNICATION_CHANNEL", "URL", "NOTES"];

    //conditions to search by
    var condition = {
        header: "STUDENT_ID",
        value: "129010",
    };
    conditions = [];
    conditions[0] = condition;

    //arrays to store returned info
    var nameInfo = [];
    var interactionInfo = [];
    var send = [];

    function getName() {
        console.log("This is getName");
        sa.getSheet("UPLS").then(response => {
            nameInfo = sa.selectFromTableWhereConditions(response, nameReturned, conditions, 1);
            console.log(nameInfo);

            let nameDiv = document.createElement("div");
            let txt = document.createTextNode("Student Name: " + nameInfo[1][1] + " " + nameInfo[1][0]);
            send[0] = nameInfo[1][1]; //first name
            send[1] = nameInfo[1][0]; //last name
            send[2] = condition.value; //student ID
            send[3] = nameInfo[1][2]; //email
            window.localStorage.setItem("send",JSON.stringify(send));
            window.localStorage.setItem("returned", JSON.stringify(interactionReturned));
            console.log("Sending: " + send);
            nameDiv.style.textAlign = "left";
            nameDiv.style.marginLeft = "450px";
            let br = document.createElement("br");
            let txt3 = document.createTextNode(" Student ID: " + condition.value);
            nameDiv.appendChild(txt);
            nameDiv.appendChild(br);
            nameDiv.appendChild(txt3);
            document.getElementById("studentInfo").appendChild(nameDiv)
        });
    }

    function createDiv(){
        sa.getSheet("INTERACTION_TRACKING").then(response => {
            interactionInfo = sa.selectFromTableWhereConditions(response, interactionReturned, conditions, 1);
            console.log(interactionInfo);

            for(let i = 1; i < interactionInfo.length; i++)
            {
                let intDiv = document.createElement("div");
                intDiv.className = "ex0";
                let btn = document.createElement("BUTTON");
                let text = document.createTextNode("Select");
                btn.setAttribute("id", "btn" + i); //add IDs to buttons
                btn.addEventListener("click", function() {
                    window.localStorage.setItem("interactionInfo",JSON.stringify(interactionInfo[i]));
                    console.log("Sending: " + interactionInfo[i]);
                    //will also need to open view_interaction page
                    window.open("view_interaction.html", "_top");
                });
                btn.appendChild(text);
                btn.style.marginTop = "65px";
                intDiv.appendChild(btn);


                //infobox holds interaction info for each interaction
                let infoBox = document.createElement("div");
                infoBox.className = "ex2";
                intDiv.appendChild(infoBox);

                //create labels for interaction info
                let date = document.createTextNode("Date: " + interactionInfo[i][1]);
                let type = document.createTextNode("Type: " + interactionInfo[i][0]);
                let librarian = document.createTextNode("Librarian Initiated: " + interactionInfo[i][2]);
                let minuets = document.createTextNode("Time Spent: " + interactionInfo[i][4]);


                //add interaction data to interaction div
                infoBox.appendChild(date);
                infoBox.appendChild(document.createElement("div"));

                infoBox.appendChild(type);
                infoBox.appendChild(document.createElement("div"));

                infoBox.appendChild(librarian);
                infoBox.appendChild(document.createElement("div"));

                infoBox.appendChild(minuets);
                document.getElementById("main").appendChild(intDiv);
            }
        });



    }



</script>

</body>
</html>