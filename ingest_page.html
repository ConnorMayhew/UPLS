<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Batch Ingest</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript">

        var json;

        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object

            // files is a FileList of File objects. List some properties.
        }
        window.onload=function(){
            document.getElementById('json').addEventListener('change', handleFileSelect, false);
        }
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object

            // files is a FileList of File objects. List some properties.
            var output = [];
            for (var i = 0, f; f = files[i]; i++) {
                var reader = new FileReader();

                // Closure to capture the file information.
                reader.onload = (function (theFile) {
                    return function (e) {
                        console.log('e readAsText = ', e);
                        console.log('e readAsText target = ', e.target);
                        try {
                            json = JSON.parse(e.target.result);
                            alert('json global var has been set to parsed json: = \n' + JSON.stringify(json));
                            console.log(JSON.stringify(json));
                            console.log(json.STUDENT_ID);
                        } catch (ex) {
                            alert('ex when trying to parse json = ' + ex);
                        }
                    }
                })(f);
                reader.readAsText(f);
            }

        }
        window.onload=function(){
            document.getElementById('json').addEventListener('change', handleFileSelect, false);
        }


    </script>
</head>
<body>
<p>Deliverable 3</p>
<input type="file" id="json" name="json[]" accept="application/json">
<output id="list"></output>

</body>
</html>